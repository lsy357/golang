@startuml
start

:拉取用户聊天卡片;
:展示聊天卡片;
fork
    :拉取部分聊天消息;
    detach
fork again
    split
        :搜索用户;
        :点击用户;
    split again
        :创建聊天;
        :搜索添加用户;
        :选择聊天模式;
        :点击完成;
    split again
        :查找已存在聊天;
        if (聊天不在近期列表) then (yes)
            :搜索聊天;
        else (no)
        endif
    end split
end fork

split
    :移除聊天卡片;
split again
    :进入聊天;
    split
        :更改聊天设置;
        split
            :设置是否消息提醒;
        split again
            :设置是否置顶;
        split again
            if (是群聊) then (yes)
                if (仅群主可管理) then (yes)
                else (no)
                    if (是群主) then (yes)
                        split
                            :修改群名称;
                        split again
                            :修改群头像;
                        split again
                            :添加群成员;
                        end split
                    else (no)
                    endif
                endif
            else (no)
            endif
        end split
    split again
        :展示消息记录;
    split again
        :发送消息;
    end split
end split

stop
@enduml